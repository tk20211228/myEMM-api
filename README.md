# プロジェクトの概要

このプロジェクトは、Firebase と Google の AMAPI (
Android Management API
)を使用して、ユーザー管理とデバイス管理を行うためのバックエンドシステムです。

主な機能：

- ユーザーのログイン情報の記録
- デバイスのリスト表示　※未実装
- ポリシーの作成　※サンプルを自動で生成
- デバイス管理
- 管理コンソールを使用しているユーザーへアナウンスメントの送信（FCM による PUSH 機能有）

# プロジェクトの構成

プロジェクト構成：

- controllers:

  - 用途：
    アプリケーションのビジネスロジックを管理します。クライアントからのリクエストを受け取り、必要なデータ操作や処理を行い、レスポンスを返します。
  - 使い方：
    各エンドポイントに対応する処理を関数として実装します。例えば、ユーザー情報の取得、更新、削除などの操作を行う関数をここに配置します。例えば、ユーザー情報の取得、更新、削除などの操作を行う関数をここに配置します。
  - 実装例：
    ユーザーのログイン情報を記録する`usersController.js`や、デバイスのリストを表示する`devicesListController.js`などがあります。

- middleware:

  - 用途：
    リクエスト処理の前後に実行される関数を管理します。認証、ログ記録、エラーハンドリングなど、共通の処理を行います。
  - 使い方：
    ミドルウェア関数を定義し、app.use()を使用してグローバルに適用するか、特定のルートに対してのみ適用します。例えば、認証ミドルウェアを使用して、認証が必要なルートを保護します。
  - 実装例：
    メモリ使用量を表示する`printMemoryUsage.js`などがあります。

- models:

  - 用途：
    データモデルとデータベーススキーマを管理します。アプリケーションで使用されるデータの構造と操作方法を定義します。
  - 使い方：
    データベース（例えば、Firebase Firestore）の各コレクションに対応するモデルを定義します。これにより、データの作成、更新、取得、削除などの操作を効率的に行えます。
  - 実装例：
    例えば、ユーザーモデルを定義した`userModel.js`があります。

- routes:

  - 用途：
    アプリケーションのルーティングを管理します。URL パスとそれに対応するコントローラーの関数をマッピングします。
  - 使い方：
    express.Router()を使用してルーターを定義し、各エンドポイントに対して HTTP メソッド（GET、POST、PUT、DELETE など）とコントローラーの関数を指定します。そして、これらのルーターをメインの app インスタンスにマウントします。

- utils:
  - 用途：
    共通のユーティリティ関数やヘルパー関数を管理します。プロジェクト全体で再利用可能な汎用的な機能を提供します。
  - 使い方：
    ログ生成、エラー処理、データ変換など、複数の場所で使用される関数を定義します。これらの関数は、コントローラーやミドルウェアから呼び出して使用します。

環境変数：

- `functions\.env-samle`: ファイル名を`.env`に変更し、必要な設定をする。

- `functions\index.js`:
  Cloud Functions のコード内で functions.config().deploy.time を使用すると、.runtimeconfig.json から deploy.time の値を読み込む。
  Firebase Cloud Functions をデプロイすると、Firebase の環境設定システムが自動的にこれらの値を関数に設定する。
  そのため、本番環境では.runtimeconfig.json ファイルは使用されず、代わりに Firebase の環境設定から直接値が読み込まれます。
  ```
  const deployTime = functions.config().deploy.time
  ```

# プロジェクトの使い方

- ローカル環境でプロジェクトを起動

  ```
  cd functions
  npm run serve
  ```

- 本番環境のデプロイ方法

  - Windows Subsystem for Linux (WSL)、Git Bash、または Cygwin などの Unix 系シェル環境のターミナルを起動する

    ```
    cd functions
    ./deploy.sh
    ```
